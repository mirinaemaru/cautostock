spring:
  profiles:
    active: live
  application:
    name: trading-system-mvp
  mvc:
    throw-exception-if-no-handler-found: true
  web:
    resources:
      add-mappings: false

  datasource:
    url: ${DB_URL:jdbc:mariadb://localhost:3306/trading_mvp?useUnicode=true&characterEncoding=utf8mb4}
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    driver-class-name: org.mariadb.jdbc.Driver
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  jpa:
    hibernate:
      ddl-auto: none
    show-sql: false
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MariaDBDialect
        format_sql: true
        use_sql_comments: true
    open-in-view: false

  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    validate-on-migrate: true

server:
  port: 8099
  shutdown: graceful

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: when-authorized

# 로그 설정은 logback-spring.xml에서 관리
# logging:
#   참조: src/main/resources/logback-spring.xml

# Application specific configuration
trading:
  broker:
    kis:
      paper:
        base-url: https://openapivts.koreainvestment.com:29443
        ws-url: ws://ops.koreainvestment.com:31000  # Stage 3: Paper trading WebSocket (non-SSL)
        app-key: ${KIS_PAPER_APP_KEY:}
        app-secret: ${KIS_PAPER_APP_SECRET:}
        account-no: ${KIS_PAPER_ACCOUNT_NO:50000000}  # PAPER 계좌번호 앞 8자리
        account-product: ${KIS_PAPER_ACCOUNT_PRODUCT:01}  # 계좌상품코드 2자리
      live:
        base-url: https://openapi.koreainvestment.com:9443
        ws-url: ws://ops.koreainvestment.com:21000  # Stage 3: Live trading WebSocket (non-SSL)
        app-key: ${KIS_LIVE_APP_KEY:}
        app-secret: ${KIS_LIVE_APP_SECRET:}
        account-no: ${KIS_LIVE_ACCOUNT_NO:}
        account-product: ${KIS_LIVE_ACCOUNT_PRODUCT:01}
      token:
        refresh-before-minutes: 30
      ws:
        reconnect-delay-ms: 5000
        max-reconnect-attempts: 10

  risk:
    global:
      max-position-value-per-symbol: 1000000
      max-open-orders: 5
      max-orders-per-minute: 10
      daily-loss-limit: 50000
      consecutive-order-failures-limit: 5

  market-data:
    symbols: "005930,035420,000660,051910,005380"  # Samsung, NAVER, SK Hynix, LG Chem, Hyundai Motor
    mode: LIVE  # STUB or LIVE - LIVE connects to actual KIS WebSocket

  market:
    check-enabled: true  # Enable market hours checking
    allowed-sessions:
      - REGULAR              # 정규장 (09:00-15:30)
      # - PRE_MARKET         # 시간외 단일가 장전 (08:30-08:40)
      # - AFTER_HOURS_CLOSING # 시간외 종가 (15:40-16:00)
      # - AFTER_HOURS        # 시간외 단일가 장후 (16:00-18:00)
    public-holidays:
      # 2025년 공휴일 (예시)
      - "2025-01-01"  # 신정
      - "2025-01-28"  # 설날 연휴
      - "2025-01-29"  # 설날
      - "2025-01-30"  # 설날 연휴
      - "2025-03-01"  # 삼일절
      - "2025-03-03"  # 대체공휴일
      - "2025-05-05"  # 어린이날
      - "2025-05-06"  # 석가탄신일
      - "2025-06-06"  # 현충일
      - "2025-08-15"  # 광복절
      - "2025-10-03"  # 개천절
      - "2025-10-06"  # 추석 연휴
      - "2025-10-07"  # 추석
      - "2025-10-08"  # 추석 연휴
      - "2025-10-09"  # 한글날
      - "2025-12-25"  # 성탄절

  outbox:
    publisher:
      enabled: true
      batch-size: 100
      poll-interval-ms: 10000
      max-retry: 3

  instrument:
    sync:
      enabled: true   # 종목 동기화 스케줄러 활성화
      cron: "0 0 2 * * *"  # 매일 새벽 2시 실행 (KST)
      # cron: "0 0 2 * * MON-FRI"  # 평일만 새벽 2시
      # cron: "0 30 8 * * MON-FRI"  # 평일 장 시작 30분 전
      markets: "KOSPI,KOSDAQ"
