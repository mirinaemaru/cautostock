spring:
  application:
    name: trading-system-mvp-test

  datasource:
    url: jdbc:h2:mem:testdb;MODE=MySQL;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    password:
    driver-class-name: org.h2.Driver

  jpa:
    hibernate:
      ddl-auto: create-drop
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.H2Dialect
        format_sql: true
        use_sql_comments: true
    open-in-view: false

  flyway:
    enabled: false  # Disable for tests, use ddl-auto=create-drop instead

server:
  port: 0  # Random port for tests

logging:
  level:
    root: WARN
    maru.trading: DEBUG
    org.springframework.web: WARN
    org.hibernate.SQL: DEBUG

# Test-specific configuration
trading:
  broker:
    kis:
      paper:
        base-url: http://localhost:8099
        ws-url: ws://localhost:8099/ws
        app-key: TEST_APP_KEY
        app-secret: TEST_APP_SECRET
      live:
        base-url: http://localhost:8099
        ws-url: ws://localhost:8099/ws
        app-key: TEST_APP_KEY
        app-secret: TEST_APP_SECRET
      token:
        refresh-before-minutes: 30
      ws:
        reconnect-delay-ms: 1000
        max-reconnect-attempts: 3

  risk:
    global:
      max-position-value-per-symbol: 100000000  # Large limit for tests
      max-open-orders: 100
      max-orders-per-minute: 1000
      daily-loss-limit: 10000000
      consecutive-order-failures-limit: 100

  market-data:
    symbols: "005930,035420"  # Minimal for tests
    mode: STUB

  market:
    check-enabled: false  # Disable market hours check for tests
    allowed-sessions:
      - REGULAR
    public-holidays:
      - "2025-01-01"
      - "2025-12-25"

  outbox:
    publisher:
      enabled: false  # Disable for tests
      batch-size: 100
      poll-interval-ms: 5000
      max-retry: 3
