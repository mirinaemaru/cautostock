# 운영 · 모니터링 · 알림 상세 명세서
(B안 – KIS OpenAPI 연계 자동매매 시스템)

---

## 1. 기능 개요

운영·모니터링·알림 기능은 자동매매 시스템을  
**안정적으로 운영하고, 이상 상황을 조기에 탐지·통지**하기 위한 영역이다.

> 이 기능은 “잘 벌기”보다  
> **“안전하게 계속 돌기”**를 보장하는 역할을 한다.

---

## 2. 기능 범위

- 시스템 상태 모니터링
- 거래·주문·체결 상태 모니터링
- 성능·지연·에러 감시
- 알림 발송(운영자/채널)
- 장애 대응 및 복구 지원
- 운영 감사 로그

---

## 3. 하위 기능 식별

| 기능 ID | 기능명 |
|---|---|
| OPS-01 | 시스템 상태 모니터링 |
| OPS-02 | 거래·주문·체결 모니터링 |
| OPS-03 | 성능 및 지연 모니터링 |
| OPS-04 | 알림 관리 |
| OPS-05 | 장애 대응 및 복구 |
| OPS-06 | 운영 감사 로그 |

---

## 4. 기능 상세 명세

---

### OPS-01. 시스템 상태 모니터링

#### 1) 설명
자동매매 시스템의 **기본 동작 상태**를 실시간으로 감시한다.

#### 2) 모니터링 항목
- 애플리케이션 프로세스 상태
- KIS REST API 연결 상태
- WebSocket 연결 상태
- 인증 토큰 유효성

#### 3) 처리
- 주기적 Health Check
- 이상 감지 시 상태 변경

#### 4) 출력
- 시스템 상태 지표
- 장애 이벤트

---

### OPS-02. 거래 · 주문 · 체결 모니터링

#### 1) 설명
실제 거래 흐름의 정상 여부를 감시한다.

#### 2) 모니터링 항목
- 전략 실행 횟수
- 신호 생성 수
- 주문 성공/실패 건수
- 체결 지연/누락 여부

#### 3) 처리
- 기준치 초과 시 경고 이벤트 생성

#### 4) 출력
- 거래 상태 대시보드

---

### OPS-03. 성능 및 지연 모니터링

#### 1) 설명
시스템 성능과 외부 연동 지연을 감시한다.

#### 2) 지표
- 전략 실행 시간
- 주문 생성 → 전송 지연
- 체결 수신 지연
- API 응답 시간

#### 3) 처리
- 임계값 기반 경고/위험 단계 분류

---

### OPS-04. 알림 관리

#### 1) 설명
중요 이벤트를 운영자에게 즉시 통지한다.

#### 2) 알림 유형
- INFO: 상태 변경
- WARN: 임계값 접근
- CRITICAL: 거래 중단 필요

#### 3) 알림 채널
- Slack
- Email
- SMS (선택)

#### 4) 처리
- 이벤트 → 알림 변환
- 중복 알림 방지
- 야간/장중 알림 정책 적용

---

### OPS-05. 장애 대응 및 복구

#### 1) 설명
장애 발생 시 시스템을 안전하게 복구한다.

#### 2) 처리 절차
1. 장애 감지
2. Kill Switch 활성화
3. 미체결 주문 정리
4. 서비스 재시작
5. 주문·체결 상태 동기화

#### 3) 출력
- 복구 완료 상태

---

### OPS-06. 운영 감사 로그

#### 1) 설명
운영 관련 모든 주요 이벤트를 기록한다.

#### 2) 기록 대상
- 시스템 시작/중지
- 설정 변경
- Kill Switch 조작
- 알림 발송

#### 3) 출력
- append-only 운영 로그

---

## 5. 데이터 모델 (요약)

### system_health
- component
- status
- checked_at

### monitoring_metrics
- metric_name
- metric_value
- recorded_at

### alert_events
- alert_id
- severity
- category
- message
- channel
- sent_at

### ops_audit_log
- audit_id
- event_type
- actor
- event_ts
- details_json

---

## 6. 연계 포인트

- 리스크 관리: Kill Switch 연동
- 주문 관리: 주문 실패 감지
- 체결·손익 관리: 손익 급변 알림
- 전략 관리: 전략 중단/재개

---

## 7. 설계 원칙

- 감지는 자동, 판단은 명확
- 알림은 **적게, 정확하게**
- 장애 시 **Fail-Safe 우선**
- 모든 운영 행위는 추적 가능

---
