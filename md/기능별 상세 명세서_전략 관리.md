# 전략 관리 상세 명세서
(B안 – KIS OpenAPI 연계 자동매매 시스템)

---

## 1. 기능 개요

전략 관리 기능은 자동매매 시스템에서  
**매매 규칙을 정의·버전관리·실행제어**하는 역할을 담당한다.

> 전략은 “사람의 판단을 코드로 고정한 것”이며,  
> 본 기능은 실거래·모의투자·백테스트에서 **동일한 전략 로직을 재사용**하는 것을 목표로 한다.

---

## 2. 기능 범위

- 전략 등록 / 수정 / 비활성
- 전략 버전 관리 (Immutable)
- 전략 파라미터 관리
- 전략 실행 주기 및 대상 관리
- 실전 / 모의 / 백테스트 모드 분리 실행
- 전략 실행 상태 모니터링

---

## 3. 하위 기능 식별

| 기능 ID | 기능명 |
|---|---|
| STR-01 | 전략 등록 |
| STR-02 | 전략 버전 관리 |
| STR-03 | 전략 파라미터 관리 |
| STR-04 | 전략 실행 제어 |
| STR-05 | 전략 대상 종목 관리 |
| STR-06 | 전략 실행 상태 관리 |

---

## 4. 기능 상세 명세

---

### STR-01. 전략 등록

#### 1) 설명
신규 자동매매 전략을 시스템에 등록한다.

#### 2) 입력(Input)
- 전략명
- 전략 설명
- 전략 유형 (예: 추세추종 / 모멘텀 / 리밸런싱)
- 작성자(옵션)

#### 3) 처리(Process)
- 전략 ID 생성
- 초기 버전(v1) 생성
- 전략 상태 `INACTIVE`로 등록

#### 4) 출력(Output)
- strategy_id
- 초기 strategy_version_id

#### 5) 예외(Exception)
- 동일 이름 전략 존재 시 Reject 또는 이름 중복 허용 정책 적용

---

### STR-02. 전략 버전 관리

#### 1) 설명
전략 로직 및 파라미터 변경 시 **기존 버전을 변경하지 않고 신규 버전을 생성**한다.

#### 2) 처리
- 전략 버전은 **Immutable**
- 버전 번호는 자동 증가
- 활성 버전은 전략당 1개만 허용

#### 3) 출력
- strategy_version_id
- version_no
- is_active

#### 4) 예외
- 실행 중인 버전 삭제 시도 → Reject

---

### STR-03. 전략 파라미터 관리

#### 1) 설명
전략 실행에 필요한 모든 설정 값을 관리한다.

#### 2) 파라미터 유형 예시
- 지표 파라미터 (MA 기간, RSI 기준 등)
- 주문 파라미터 (기본 주문 수량, 비중)
- 리스크 보조 파라미터 (손절/익절 값)

#### 3) 입력
- 파라미터 JSON
- 스키마 정의(JSON Schema)

#### 4) 처리
- 스키마 검증
- 파라미터 변경 시 신규 버전 생성

#### 5) 출력
- params_json
- schema_version

---

### STR-04. 전략 실행 제어

#### 1) 설명
전략의 실행 여부 및 실행 방식을 제어한다.

#### 2) 실행 모드
- `LIVE` : 실거래
- `PAPER` : 모의투자
- `BACKTEST` : 백테스트

#### 3) 실행 조건
- 실행 주기 (예: 1분봉, 일봉)
- 실행 시간 (장중 / 장마감)

#### 4) 처리
- 실행 스케줄 등록
- 실행 전 계좌/권한/환경 검증

#### 5) 예외
- 실전 계좌에 BACKTEST 실행 시 Reject
- 비활성 전략 실행 요청 → Reject

---

### STR-05. 전략 대상 종목 관리

#### 1) 설명
전략이 적용될 종목 집합을 관리한다.

#### 2) 대상 설정 방식
- 고정 종목 리스트
- 조건 기반 필터 (시총, 거래량 등)
- 외부 입력(지수 구성 종목 등)

#### 3) 처리
- 대상 종목 스냅샷 생성
- 실행 시점 기준 대상 확정

#### 4) 출력
- strategy_targets

---

### STR-06. 전략 실행 상태 관리

#### 1) 설명
전략의 실행 상태를 관리하고 모니터링한다.

#### 2) 상태 정의
- `READY`
- `RUNNING`
- `PAUSED`
- `ERROR`
- `STOPPED`

#### 3) 처리
- 상태 전이 로그 기록
- 장애 발생 시 자동 중단

#### 4) 출력
- 실행 상태
- 최근 실행 시각
- 오류 메시지

---

## 5. 데이터 모델 (요약)

### strategies
- strategy_id (PK)
- name
- description
- status
- created_at

### strategy_versions
- strategy_version_id (PK)
- strategy_id (FK)
- version_no
- params_json
- is_active
- created_at

### strategy_targets
- strategy_version_id
- symbol
- created_at

### strategy_runs
- run_id
- strategy_version_id
- mode (LIVE/PAPER/BACKTEST)
- status
- started_at
- ended_at

---

## 6. 연계 포인트

- 시장 데이터 관리: 시세 입력
- 신호 생성: 전략 로직 실행 결과 전달
- 리스크 관리: 실행 전/후 제한 적용
- 주문 관리: 신호 기반 주문 생성
- 백테스트: 동일 전략 재사용

---

## 7. 설계 원칙

- 전략 로직과 실행 환경 분리
- 전략 버전 불변성 보장
- 실전/모의/백테스트 **동일 코드**
- 전략 실행은 반드시 **추적 가능**

---
