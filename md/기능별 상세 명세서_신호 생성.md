# 신호 생성 상세 명세서
(B안 – KIS OpenAPI 연계 자동매매 시스템)

---

## 1. 기능 개요

신호 생성 기능은 전략 관리 영역에서 정의된 전략을 실행하여  
**매수·매도·유지(HOLD) 의사결정을 신호(Signal) 형태로 생성**하는 역할을 담당한다.

> 신호는 전략과 주문 사이의 **중간 의사결정 결과물**이며,  
> 리스크 관리·주문 관리·백테스트에서 공통으로 사용된다.

---

## 2. 기능 범위

- 전략 기반 신호 생성
- 지표 계산 및 조건 평가
- 목표 수량/비중 산출
- 신호 유효기간(TTL) 관리
- 중복/과다 신호 방지
- 실행 이력 및 감사 로그 생성

---

## 3. 하위 기능 식별

| 기능 ID | 기능명 |
|---|---|
| SIG-01 | 전략 실행 트리거 |
| SIG-02 | 지표 계산 |
| SIG-03 | 신호 판단 |
| SIG-04 | 목표 수량/비중 계산 |
| SIG-05 | 신호 유효기간 관리 |
| SIG-06 | 신호 중복/충돌 방지 |
| SIG-07 | 신호 이력 및 감사 |

---

## 4. 기능 상세 명세

---

### SIG-01. 전략 실행 트리거

#### 1) 설명
시장 데이터 또는 스케줄에 의해 전략 실행을 트리거한다.

#### 2) 입력(Input)
- 전략 ID / 전략 버전 ID
- 실행 모드 (LIVE / PAPER / BACKTEST)
- 시세 이벤트(틱/봉)
- 실행 시각

#### 3) 처리(Process)
- 전략 활성 상태 확인
- 실행 주기(1분봉/일봉) 검증
- 동일 시점 중복 실행 방지

#### 4) 출력(Output)
- 전략 실행 컨텍스트 생성

#### 5) 예외(Exception)
- 비활성 전략 실행 요청 → Reject
- 데이터 부족 → 실행 보류(HOLD)

---

### SIG-02. 지표 계산

#### 1) 설명
전략에 정의된 지표를 계산한다.

#### 2) 입력
- 시계열 데이터(가격/거래량)
- 전략 파라미터

#### 3) 처리
- 이동평균, RSI, VWAP 등 계산
- 워밍업 기간 체크
- 계산 결과 캐싱

#### 4) 출력
- Indicator Value Set

#### 5) 예외
- 워밍업 기간 미충족 → HOLD 신호 생성

---

### SIG-03. 신호 판단

#### 1) 설명
계산된 지표와 전략 규칙을 평가하여 신호를 판단한다.

#### 2) 신호 유형
- BUY
- SELL
- HOLD

#### 3) 처리
- 조건식 평가
- 다중 조건 충돌 시 우선순위 적용
- 동일 방향 연속 신호 필터링

#### 4) 출력
- Signal Decision

#### 5) 예외
- 조건 불명확 → HOLD

---

### SIG-04. 목표 수량 / 비중 계산

#### 1) 설명
신호에 따른 **주문 목표 값**을 산출한다.

#### 2) 입력
- 신호 유형
- 전략 파라미터
- 계좌 잔고 / 포지션 정보

#### 3) 처리
- 고정 수량 방식
- 비중 기반 방식
- 최소 주문 수량 검증

#### 4) 출력
- target_type (QTY / WEIGHT)
- target_value

#### 5) 예외
- 매수 가능 금액 부족 → 신호 무효화 또는 축소

---

### SIG-05. 신호 유효기간(TTL) 관리

#### 1) 설명
신호가 유효한 시간을 관리한다.

#### 2) 입력
- 신호 발생 시각
- TTL 설정값(초/분)

#### 3) 처리
- TTL 만료 시 신호 자동 폐기
- 지연 실행 시 신호 무효 처리

#### 4) 출력
- signal_status (ACTIVE / EXPIRED)

---

### SIG-06. 신호 중복 / 충돌 방지

#### 1) 설명
과도한 주문을 방지하기 위해 신호를 제어한다.

#### 2) 처리
- 동일 종목·동일 방향 신호 최소 간격 적용
- BUY ↔ SELL 충돌 시 최신 신호 우선 또는 HOLD 처리
- 미체결 주문 존재 시 신호 제한

#### 3) 출력
- 신호 차단 사유 코드

---

### SIG-07. 신호 이력 및 감사

#### 1) 설명
생성된 모든 신호를 추적 가능하게 기록한다.

#### 2) 기록 항목
- 전략 버전
- 종목 코드
- 신호 유형
- 판단 근거(지표 값)
- 생성 시각

#### 3) 출력
- 신호 로그
- 감사 로그

---

## 5. 데이터 모델 (요약)

### signals
- signal_id (PK)
- strategy_version_id (FK)
- symbol
- signal_type (BUY/SELL/HOLD)
- target_type (QTY/WEIGHT)
- target_value
- ttl_seconds
- signal_ts
- status

### signal_indicators
- signal_id (FK)
- indicator_name
- indicator_value

### signal_audit_log
- audit_id
- signal_id
- event_type
- event_ts
- details_json

---

## 6. 연계 포인트

- 전략 관리: 전략 정의/파라미터 참조
- 시장 데이터 관리: 시세 입력
- 리스크 관리: 주문 전 검증
- 주문 관리(OMS): 주문 생성 요청
- 백테스트: 체결 시뮬레이션 입력

---

## 7. 설계 원칙

- 신호는 **결정 결과이지 주문이 아님**
- 신호 생성과 주문 실행은 반드시 분리
- 동일 전략 로직의 재현성 보장
- 모든 신호는 사후 분석 가능해야 함

---
